# 5. SpatGRIS

• *SpatGRIS* does spatialization and localization.

• *SpatGRIS* is a recorder and a player.

• *SpatGRIS* makes speaker setups.

## 5.1. Introduction

There are three components in *SpatGRIS* that are saved independently:
Project, Speaker Setup and Settings.

• **Save Project**. A project is coupled with a work that contains a
certain number of sources (outputs from the DAW) and the Mode used. This
is the component on the top right of *SpatGRIS*.

• **Save Speaker Setup**. A speaker setup is coupled to an installation
placed in a space and the algorithm used. This is the section shown in
*SpeakerView*.

• **Save Settings**. User settings are linked to a workstation —
computer and audio interface — including the stereo outputs used for
stereo reduction (even without showing them). Most of the settings are
shown in the Info bar. Click the Info bar or Settings in the File menu
(Cmd-,).

NOTE: The DOME and the CUBE modes are saved in Speaker Setups and
Projects, but the HYBRID mode is only saved in projects. The last opened
document — whether it be a Speaker Setup or a Project — determines the
Mode.

The *SpatGRIS* window is divided into different zones:

• Sources

• VU Meters.

• Settings and Info.

• Controls.

• Recording.

*SpeakerView* shows the speakers in a 3D view.

<img src="/media-en/media/image47.png"
style="width:6.5in;height:3.8681in" />

## 5.2. SpeakerView

As of *SpatGRIS* version 3.3.3, the 3D representation of loudspeakers is
supported by an independent application called *SpeakerView.* This
change was necessary in order to meet the requirements of Apple Silicon
processors for Mac. Everything is better here: speaker transparency,
number legibility and fluidity of movement have all been dramatically
improved.

*SpeakerView* is shown here with the new Show Hall function:

<img src="/media-en/media/image48.jpg"
style="width:3.32465in;height:3in" />

### 5.2.1. Visibility and keyboard shortcuts

*SpeakerView* is displayed independently of *SpatGRIS*. By default, it
is displayed at the same time as *SpatGRIS*. However, it can be opened
or closed independently (Mac: Opt-V. Windows: Alt-V).

Keyboard shortcuts in the *SpatGRIS* View menu control display options
in *SpeakerView*:

<img src="/media-en/media/image49.jpg"
style="width:1.6in;height:2.38881in" />

### 5.2.2. Two distinct applications

Although *SpeakerView* resembles the 3D representation that existed in
versions *of SpatGRIS* prior to 3.3.0, it is a separate application. It
can be moved and sized independently. You can also choose to force it to
stay on top of *SpatGRIS* (Keep SpeakerView On Top).

NOTE: SpeakerView is an autonomous application, but there is no need for
the user to worry about that, *SpatGRIS* will take care of everything.
We even strongly recommend that *SpeakerView* shouldn't be started
neither from the Finder nor the Dock. If it's opened this way, this the
warning message that will pop up:

<img src="/media-en/media/image50.jpg"
style="width:1.22256in;height:1in" />

## 5.3. Change the setup not the spatialization

The most interesting feature in *SpatGRIS* is that the *Sources,* which
come from the DAW and represent the audio and the spatialization of your
work, are independent of the *speakers*. So, if you initially defined a
very complex spatialization structure for a specific speaker
arrangement, you could play it on any other speaker setup afterwards,
especially in DOME mode. You simply have to change the Speaker Setup
from one location to the next.

Here's an example of a piece designed for a 16-Speaker Setup (on the
left), presented on an entirely different 24-speaker system (right),
simply by switching from one system to the other.

As you can see, all the sources remain at the exact same coordinates.
They will be played by different speakers but heard at the same location
in the concert hall.

<img src="/media-en/media/image51.jpg"
style="width:2.52231in;height:3.14961in" /><img src="/media-en/media/image52.jpg"
style="width:2.52292in;height:3.14931in" />

## 5.4. Settings

<img src="/media-en/media/image9.jpg"
style="width:1.95241in;height:1.9685in" />

Audio Settings

• Audio device type: Core Audio (default).

• Audio input device: *BlackHole* (ideally).

• Audio output device: your audio interface.

• Sampling Rate (Hz): from 44100 to 192000, according to your audio
interface.

• Buffer Size (spls): from 16 to 2048. Adjust the Buffer size at the
same value in your DAW and in *SpatGRIS*.

General Settings:

• OSC Input Port: default is 18032 which is the same as *ControlGRIS*.
If you want to use another incoming OSC device, use this port number as
the output port of that device, otherwise you must change this number
accordingly.

**Close**

Your settings are automatically saved. Under the name of the version of
*SpatGRIS,* the document is located here (Mac):

• ~/Library/Application Support/GRIS/SpatGRIS.0.0 (for example).

## 5.5. Controls

<img src="/media-en/media/image53.png"
style="width:6.375in;height:3in" />

## 5.6. The DOME and the CUBE

In DOME mode, it is possible to place the sources on the surface of the
dome made by the speaker setup while in CUBE mode it is possible to move
and place the sources inside and outside the speaker setup.

### 5.6.1. DOME

The DOME based on VBAP (Vector Base Amplitude Panning), allows the user
to spatialize the sound on a dome of speakers according to the relative
amplitude of three speakers (as opposed to two in stereo panning).
Therefore, the dome is made of triangles of speakers. This way, the
sound can travel smoothly on the surface of the dome, with no bumps or
holes.

It is possible to see the triangles by choosing Show Speaker Triplets
(Opt-T) in the *View* menu. If you have the chance to use a complete
sphere, it is possible to show it (Opt-O)!

<img src="/media-en/media/image54.jpg"
style="width:2.98251in;height:2.35in" /><img src="/media-en/media/image55.jpg"
style="width:2.48066in;height:2.35in" />

### 5.6.2. CUBE

Since version 3.2.0, the CUBE is based on the MBAP algorithm (Matrix
Base Amplitude Panning) and it allows the placement of a source anywhere
in a space represented by a cube. But it is not limited to the shape of
a cube. Any speaker setup can be placed within a cube (including a
dome!) Therefore, any sound installation or concert situation can be
simulated here. In CUBE mode, the distance of the source exiting the
speaker setup is considered to simulate the natural behaviour of the
sound moving away.

As the name suggests, the algorithm is based on a precomputed
three-dimensional matrix of multiple points per speaker that determines
the amplitude of a source at a specific position.

<img src="/media-en/media/image56.jpg"
style="width:3.03429in;height:2.36in" /><img src="/media-en/media/image57.jpg"
style="width:2.13694in;height:2.36in" />

## 5.7. The HYBRID mode: DOME and CUBE in the same project

The HYBRID mode is not really a new algorithm, but a combination of the
DOME and the CUBE ones. HYBRID mode can be selected in the Algorithm
section:

<img src="/media-en/media/image58.jpg"
style="width:1.60417in;height:0.5in" />

The Sources menu is then changed to offer the possibility of choosing
between the dome or the cube behaviour independently for each source:

<img src="/media-en/media/image59.jpg"
style="width:2.48684in;height:0.9in" />

The HYBRID mode uses the DOME algorithm, which means that the speaker
setup must be a dome (if not, you will be asked to convert it) within
which the sources can be moved according to CUBE behaviours where it's
possible to move the sound inside or outside the dome of speakers. In
HYBRID mode, the spans keep their usual dome or cube behaviour.

### 5.7.1. What is saved in HYBRID mode?

There are two types of information that are saved with the project in
HYBRID mode:

• The HYBRID mode itself is saved exclusively with the project.

• The selection of the DOME or the CUBE algorithm for each source is
also saved with the project.

### 5.72. What Mode is loaded according to the opening order of Speaker Setup and Project?

As a rule, it is always the last opened document — Speaker Setup or
Project — that determines the algorithm used by *SpatGRIS*.

A Speaker Setup (SS) followed by a Project (P):

1.1. SS Dome + P Dome = Dome.

2.1. SS Cube + P Cube = Cube.

3.1. SS Dome + P Cube = Cube. The SS Dome has been converted to SS Cube.
The shape of the SS does not change, since the Cube algorithm accepts
all domes (this can be confirmed by opening the Speaker Setup Edition
window). Before closing the SS, you'll be asked to save the changes.

4.1. SS Cube + P Dome = Dome. The SS Cube is converted into a Dome after
the conversion message is approved.

5.1. SS Dome + P Hybrid = Hybrid.

6.1. SS Cube + P Hybrid = Hybrid. SS Cube is converted to Dome after the
conversion message is approved.

In reverse order:

1.2. P Dome + SS Dome = Dome.

2.2. P Cube + SS Cube = Cube.

3.2. P Cube + SS Dome = Dome. The Cube project has been converted to SS
Dome.

4.2. P Dome + SS Cube = Cube. The Dome project has been converted to SS
Cube.

5.2. P Hybrid + SS Dome = Hybrid. This is the only exception where
Hybrid has priority, despite the fact it was loaded first. It's because
Hybrid projects works on SS Dome only.

6.2. P Hybrid + SS Cube = Cube. Hybrid disappears from the view since we
have just switched to Cube. This is normal. By selecting Hybrid manually
afterwards, the SS Cube is converted into a Dome after the conversion
message is approved. The saved information of the P Hybrid is then
recovered.

### 5.7.3. Attenuation settings in CUBE or HYBRID mode

In CUBE and HYBRID modes, there are an inner circle and an outer circle
in the middle of the Speaker Setup. Within the inner circle, attenuation
and/or filtering are not applied. Outside the inner circle, attenuation
and/or filtering can be applied to simulate the vanishing of a sound at
a faraway distance. At the outer circle, attenuation and filtering reach
their maximum values. You can indicate these maximum values in the
Attenuation settings menus. In HYBRID mode, Attenuation settings work
only on CUBE sources.

<img src="/media-en/media/image60.png"
style="width:2.70371in;height:3.5in" />

Actually, the inner circle is a sphere within which the attenuation
settings start to be calculated from the «floor», that is to say from
the coordinates (0.0, 0.0):

<img src="/media-en/media/image61.jpg"
style="width:2.7in;height:2.55894in" />

Attenuation settings parameters:

<img src="/media-en/media/image62.jpg"
style="width:3in;height:0.79808in" /><img src="/media-en/media/image63.jpg"
style="width:3in;height:0.8in" />

<img src="/media-en/media/image64.jpg"
style="width:3in;height:1.19167in" /><img src="/media-en/media/image65.jpg"
style="width:3in;height:1.19in" />

• On/Off

• Volume (dB): from 0 to -72, in -12dB steps.

• Filtering (Hz): from 125 to 16000, in octave steps.

• Volume and filtering are independent.

• In Elevation, attenuation starts at the top (Extended Top) and at the
bottom (Extended Top and Bottom) of the cube.

• Attenuation settings also work in STEREO and BINAURAL mode.

NOTE: Attenuation Settings are saved within the Project.

### 5.7.4. Convert from DOME to CUBE and vice versa

In the case of switching from DOME to CUBE, *SpatGRIS* uses XYZ
coordinates of the setup to maintain the integrity of the setup. This
does not apply to the transition from CUBE to DOME, since in the VBAP
algorithm the distance is always adjusted to 1.00. Elevation and
Distance do not have the same behaviour in the DOME and CUBE algorithms.
A speaker setup retains its appearance and XYZ coordinates when
transitioning from the DOME algorithm to the CUBE algorithm, but not the
other way around.

### 5.7.5. Spatialization in 2D and 3D

*SpatGRIS* is capable of 2D and 3D spatialization either in DOME or CUBE
mode. It can be useful to use *SpatGRIS* in 2D with DAWs that are
stereo-only like Ableton Live and Pro Tools native. Doing so gives these
stereo DAWs the possibility to manage multispeaker environment like
cinema standards. But of course, the real power of *SpatGRIS* lies in
its 3D capabilities.

The following images present an example of a 2D speaker setup — an
octophony—, and a 3D speaker setup — a cube of 24 (3x8) speakers.

<img src="/media-en/media/image66.jpg"
style="width:2.73896in;height:2.3622in" /><img src="/media-en/media/image67.jpg"
style="width:2.59476in;height:2.3622in" />

## 5.8. Speaker Setup

To design a speaker setup is the first step of the process. It is done
in the *Speaker Setup Edition* window (View menu, Opt-W).

A Templates menu is provided with different speaker setups in DOME or
CUBE format. The speaker setups in the Templates can’t be modified. You
can use them, edit them, and save them under the name of your choice by
using Save Speaker Setup As from the File menu.

<img src="/media-en/media/image68.jpg"
style="width:2.06464in;height:1.5in" />

### 5.8.1. Speaker Setup Edition

<img src="/media-en/media/image69.png"
style="width:6.2in;height:3.73565in" />

Since the introduction of the MBAP (version 3.20 and up) in CUBE mode,
the Global Sound Diffusion parameter allows changing the diffusion of
the sound globally for the whole set of speakers. Precise localization
is obtained with a small value, higher values will result with a blurred
spatial image. This parameter can also influence the smoothness of
trajectories.

Except for Distance which is set to 1.00 in DOME mode (by definition),
speaker setup parameters can be set by polar values in DOME (Azimuth,
Elevation) or by Cartesian values in CUBE (X, Y, Z). In DOME mode,
Cartesian values are greyed out. In CUBE mode, polar values are greyed
out.

### 5.8.2. Speakers’ order and image representation

By clicking at the top of each column (except for Gain and Highpass) in
the Speaker Setup Edition window, the order of the speakers can be
organized). The most important one is the Output column where you can
move manually or automatically each speaker. This order will be
reflected in the Speakers VU-meter ordering. (With the rewrite of the speaker setup window to include speaker group, this was removed and should be added back. There is now a sort by ID button)

Consecutive order:

<img src="/media-en/media/image70.jpg"
style="width:4.72441in;height:1.41732in" />

Odd and even order followed by direct outputs:

<img src="/media-en/media/image71.jpg"
style="width:4.72441in;height:1.35373in" />

Here is an example of a speaker order that represents the actual
position of the speakers in a studio with respect to the Y-axis (See
5.9.1 for more information). One can see on the speaker VU-meter section
how the energy is distributed from the left to the right in the dome.
The speakers 11 and 20 are in the centre, and the subs on the extreme
left and right like they are placed in the studio. All the other
speakers are equally distributed along the Y-axis:

<img src="/media-en/media/image72.jpg"
style="width:6.25in;height:2.02457in" />

### 5.8.2.1 Groupes de haut-parleurs

It is possible to create speaker groups. This can allow you to make grouped position changes and it makes some speaker setups easier to create.

Two speaker group presets are available: rings and polyhedrons.

For ring preset, you can choose the amount of speakers, the initial elevation, the "distance" which corresponds to the radius of the ring and the initial yaw rotation angle.

For the polyhedron preset, you can choose polyhedrons with more or less faces. This preset was conceived for multidirectional speakers and works well in Dome (or hybrid) mode.

Once a group is created, you can move the whole group of speakers in 3d space as you would move any other speaker. A small cog icon allows you to rotate the group.

You can also modify the relative position of a speaker inside the group and also add and remove to and from the group by drag and dropping them.

### 5.8.3. Minimal requirements

The DOME in particular needs minimal requirements to perform the VBAP
calculations. If the speaker setup doesn’t fulfill them, you’ll be
warned by one or two of these messages:

<img src="/media-en/media/image73.jpg"
style="width:3in;height:1in" /><img src="/media-en/media/image74.jpg"
style="width:3in;height:1in" />

### 5.8.4. Direct outputs

<img src="/media-en/media/image75.jpg"
style="width:0.38819in;height:1.96806in" />A sound Source can be sent
directly to a speaker via a direct output. There are two types of direct
outputs in *SpatGRIS*, which was not the case before.

#### Independent direct outputs

There are independent direct outputs intended for special uses like the
subwoofers. These speakers are identified with an orange rectangle in
the Speaker Setup Edition window.

<img src="/media-en/media/image76.jpg"
style="width:5.9in;height:0.53327in" />

Their placement in the setup is not that critical, since they are
independent of the spatialization, but if you intend to downmix your
project in a two-channel format, their sound will be placed in the
stereo image according to their left-right position. They are
represented in black in the 3D SpeakerView.

<img src="/media-en/media/image77.jpg"
style="width:6.18056in;height:1.38889in" />

#### Spatialized direct outputs

This is a new feature in *SpatGRIS*. Any speaker in the setup can be
used as a direct output and continue to be used by the spatialization
algorithms. Every source has a direct output text box that is empty by
default. Any speaker number can be put in there. The difference between
the types of direct outputs is that independent outputs are used only
for that purpose. There is no distinction in the speaker 3D view for the
spatialized direct outputs.

Spatialized direct outputs were created by Samuel Béland, a major
improvement of *SpatGRIS*.

One can see the distinction when selecting a direct output. The first
numbers, at the top of the column (17-18) are independent direct
outputs. The other numbers (1-16) can be used as a spatialized direct
output.

In the following example, source 5 is sent directly to speaker 9 and
source 8 to speaker 14. Both speakers 9 and 14 remains in the DOME
configuration. Finally, we have sources 15-16 sent to independent direct
outputs 17-18:

<img src="/media-en/media/image78.png"
style="width:4.56693in;height:5.70866in" />

NOTE: Since direct outputs are assigned to specific outputs, if you open
a project with different numbers of direct outputs than those in the
actual speaker setup, some outputs may be muted! There is no warning for
that!

### 5.8.5. Show Speaker Numbers

The location of the speakers and their numbers can be viewed in the 3D
window by choosing the Show Speaker Numbers option (Opt-Z[^opt-z-footnote]). Direct
outputs are shown in black. Clicking on a speaker or its number selects
it; right-clicking deselects it. In the above image, speaker 3 is
selected and independent direct outputs 17-18 are in black. Show Speaker
Numbers only works if Show Speakers is active in the View menu.

## 5.9. Sources and Speakers

*SpatGRIS* receives audio signals from the DAW and sends them to the
speakers. The two main sections are the *Sources* (from the DAW through
*BlackHole*) and the *Speakers.* There are also the direct outs that are
sent directly from the sources to these speakers (for subwoofers for
instance).

<img src="/media-en/media/image79.png"
style="width:5.25in;height:4.86111in" />

In this example, the sources are made of 4 X octophonic sources (1-32),
plus 1 X stereo source (33-34), 1 X stereo spatialized direct outputs
(35-36 sent to 53-54) and 1 X independent direct output (37-38, assigned
to 5-6) for a total of 38 sources identified by different groups of
colours, distributed on a 32-speaker dome with 2 independent direct outs
(5-6).

### 5.9.1. Mute and Solo

Each source and speaker have a *Mute* and a *Solo* button.

<img src="/media-en/media/image80.png"
style="width:3.40909in;height:3in" />

### 5.9.2. Peak indicators and Reset

A peak indicator is present for Sources and Speakers. There is a general
Reset Meter Clipping in the view menu (Opt-M).

## 5.10. STEREO reduction

### 5.10.1. STEREO

There is a STEREO mode to listen to a complex project on a pair of
speakers. All the sounds are sent to the corresponding speakers
depending on their location (left to left, right to right, no front-back
axis, no elevation). When STEREO is selected, the stereo routing option
appears to allow you to choose the outputs of your choice, depending on
your sound card. Only your sound card outputs are available for the
stereo reduction. When using the computer internal sound card, the
outputs are allocated to numbers 1 and 2.

<img src="/media-en/media/image81.jpg"
style="width:2.38559in;height:0.8in" />

This mode can be used to downsize a multichannel project to stereo. The
sources are simply placed on the Y-axis from left to right. Only the
azimuth span is used in STEREO mode, not the Elevation span. Keep in
mind that the sources, except for the direct outputs, are never placed
directly on a speaker, but on many speakers — at least three on a DOME,
many more on a CUBE. So, the projection of the sources is probably not
accurate as it shows on this representation!

<img src="/media-en/media/image82.png"
style="width:5in;height:3.17343in" />

### 5.10.2. BINAURAL

This algorithm was implemented to help users to work on 3D
spatialization from home when access to a speaker dome is limited or
unavailable. It is based on a Head Related Transfer Function (HRTF).
HRTF is a function that reproduces the way we perceive the localization
of sounds in the space. It is a set of phase and amplitude calculations
for listening on headphones. Primarily, it is designed for 5.1
reproductions or immersive listening on headphones, situations found in
the gaming and the Virtual Reality industries. To minimize the number of
calculations (HRTF can be very demanding in terms of computing power),
*SpatGRIS* first calculates a VBAP spatialization over 16 speakers (with
the BINAURAL_SPEAKER_SETUP, made invisible in this version) and then
transfers the result to HRTF. Don't worry, even if your speaker setup
contains more than 16 speakers, no information is lost in the process.
BINAURAL modes use the stereo outputs of your choice. Both Spans are
available in BINAURAL mode.

For various reasons and due to technical considerations, the output
loudness of STEREO mode differs considerably from BINAURAL, mode
depending on the number of sources. Please adjust your listening level
accordingly.

NOTE: The Attenuation Settings used in Cube or Hybrid mode, are
functional in stereo reduction.

## 5.11. Recording

When the composition of the spatialization is completed, you have two
options:

1\. To play the piece "live" with your DAW and *SpatGRIS*.

2\. To record the spatialization to as many audio channels as the number
of the speakers in the setup.

*SpatGRIS* records mono files (AIFF or WAV according to your
preferences) or one interleaved file.

To record: press the big red button on the bottom right of the main
window.

<img src="/media-en/media/image83.jpg"
style="width:0.79167in;height:0.79167in" />

A pop-up window will then open, allowing you to specify:

• The location of the recorded files.

• Their name.

• The format: WAV or AIFF.

• The number of files: Mono Files or Interleaved.

• The possibility to export the Speaker Setup for the Player function
(chapter 6).

Pressing the Record button will start the recording and the timer, and
it will change the Record button to a blinking one. When it’s completed,
you can press the Record button again to stop the recording. You can
then import the separate mono files (or an interleaved file) into any
DAW to play your piece in concert.

<img src="/media-en/media/image84.jpg"
style="width:4.5in;height:1.20288in" />

Keep in mind that with interleaved files, there are some limitations,
and these limitations are reached quite rapidly on big projects:

• AIFF is limited to 2 GB.

• WAV is limited to 4 GB[^4gb-footnote].

Also, if you record a file with many channels, you’ll find very few DAWs
capable of opening it. So, it’s preferable to record Mono files.

[^opt-z-footnote]: It seems that on some Azerty keyboard, this key combination is not working. The function is still available though.
[^4gb-footnote]: CAF (Core Audio Format) and WAV RF64 will eventually be implemented enabling size to exceed 4 GB.
